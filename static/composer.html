<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhiteNoise · 音效组合器</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/composer.css">
</head>
<body>
    <div class="app composer-app">
        <!-- 头部 -->
        <header class="header">
            <div class="header-nav">
                <a href="/" class="nav-link">← 返回混音器</a>
            </div>
            <h1 class="logo">音效组合器</h1>
            <p class="tagline">创作你的音效交响乐</p>
        </header>

        <!-- 组合列表 -->
        <section class="compositions-section">
            <div class="section-header">
                <h2 class="section-title">音效组合</h2>
                <button class="btn-new" id="btnNewComposition">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    新建组合
                </button>
            </div>
            <div class="compositions-grid" id="compositionsGrid">
                <!-- 动态生成 -->
            </div>
        </section>

        <!-- 播放器面板 -->
        <section class="player-panel" id="playerPanel" style="display: none;">
            <div class="player-header">
                <div class="player-info">
                    <h3 class="player-title" id="playerTitle">-</h3>
                    <p class="player-desc" id="playerDesc">-</p>
                </div>
                <button class="btn-close" id="btnClosePlayer">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- 时间轴 -->
            <div class="timeline-container">
                <div class="timeline-header">
                    <div class="time-ruler" id="timeRuler">
                        <!-- 动态生成时间刻度 -->
                    </div>
                </div>
                <div class="timeline-tracks" id="timelineTracks">
                    <!-- 动态生成音轨 -->
                </div>
                <div class="timeline-cursor" id="timelineCursor"></div>
            </div>

            <!-- 进度条 -->
            <div class="progress-container">
                <span class="time-current" id="timeCurrent">0:00</span>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-handle" id="progressHandle"></div>
                </div>
                <span class="time-total" id="timeTotal">0:00</span>
            </div>

            <!-- 控制按钮 -->
            <div class="player-controls">
                <button class="btn-control" id="btnRestart" title="重新开始">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 4v6h6M23 20v-6h-6"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                </button>
                <button class="btn-play-large" id="btnPlayPause">
                    <svg class="icon-play" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg class="icon-pause" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" style="display:none">
                        <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                    </svg>
                </button>
                <button class="btn-control" id="btnStop" title="停止">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="6" width="12" height="12"/>
                    </svg>
                </button>
                <div class="volume-control">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                        <path d="M15.54 8.46a5 5 0 010 7.07"/>
                    </svg>
                    <input type="range" id="volumeSlider" min="0" max="100" value="80" class="slider">
                </div>
                <button class="btn-control btn-render" id="btnRender" title="导出 MP3">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    导出
                </button>
            </div>
        </section>

        <!-- 音轨详情面板 -->
        <section class="tracks-detail" id="tracksDetail" style="display: none;">
            <h3 class="detail-title">音轨列表</h3>
            <div class="tracks-list" id="tracksList">
                <!-- 动态生成 -->
            </div>
        </section>
    </div>

    <!-- 渲染状态弹窗 -->
    <div class="modal" id="renderModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>导出 MP3</h3>
            </div>
            <div class="modal-body">
                <div class="render-status" id="renderStatus">
                    <div class="spinner"></div>
                    <p>正在合成音频，请稍候...</p>
                </div>
                <div class="render-complete" id="renderComplete" style="display: none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    <p>合成完成！</p>
                    <a class="btn-download" id="downloadLink" href="#" download>下载 MP3</a>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal-close" id="btnCloseModal">关闭</button>
            </div>
        </div>
    </div>

    <script src="/static/js/composer.js"></script>
</body>
</html>
